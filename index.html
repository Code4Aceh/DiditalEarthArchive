<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta name="description" content="「code4aceh」"/>
	<meta property="og:image" content="https://lh3.googleusercontent.com/-sIywMlxf7jQ/VRlmbSpEyfI/AAAAAAAFXus/hZCyzqWaeuE/s400/Screen%2520Shot%25202015-03-31%2520at%25200.05.07.png"/>
	<meta property="og:description" content="code4aceh"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

<title>LOCAL GOOD-YOKOHAMA-</title>
	<link rel="SHORTCUT ICON" href="https://cf.yokohama.localgood.jp/favicon.ico">
	<style>
		@import url(Build/Cesium/Widgets/widgets.css);
	</style>
	<link rel="stylesheet" type="text/css" media="all" href="Build/css/style.css" />
	<link rel="stylesheet" type="text/css" media="all" href="Build/css/menubutton.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="Build/js/slidein.js"></script>
	<script src="Build/Cesium/Cesium.js"></script>
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-55397811-5', 'auto');
	ga('send', 'pageview');
	
	</script>
</head>
<body>
	<div id="slider">
		<input id="range01" type="range" min="0" max="20" value="20" step="1" oninput="transParent();"/>
	</div>
	<div id="blackOut"><img class="loading" src="Build/data/loading.gif"></div>
	<div id="cesiumContainer"></div>
<!--	<div id="button" class="general-button">
		<div class="button-content">
			<span class="icon-font">menu</span>
		</div>
	</div> -->
	<div id="check_bar">
		<form name="check_box">
			<input type="checkbox" name="local1" checked="checked">local good player（インタビュー）<br>
			<input type="checkbox" name="local2" checked="checked">Local good files（地域の情報）<br>
			<input type="checkbox" name="local3" checked="checked">地域の課題<br>
			<input type="checkbox" name="local4">ジオツイート<br>
			<input type="checkbox" name="local5">施設情報	
		</form>
	</div>
	<div id="menubar">
		<div id="menu_check" class="menu_button"><img src="img/icon_check.png"></div>
		<div id="menu_about" class="menu_button"><img src="img/icon_about.png"></div>
		<div id="c_place" class="menu_button"><img src="img/icon_place.png"></div>
<!--		<div id="zentai" class="menu_button"><img src="img/icon_view.png"></div>		
		<div id="scene_2d" class="menu_button"><img src="img/icon_2d.png"></div>
		<div id="zentai" class="menu_button"><img src="img/icon_view.png"></div>
		<div id="c_place" class="menu_button"><img src="img/icon_place.png"></div>
-->
	</div>
	<div id="setsumei">
		<img src="img/color_sisetsu_yokohama.png">
		<img src="img/color_task_yokohama.png">
	</div>
<!--
	<div id="scene_mode">
		<div id="mode_3d" class="menu_button"><img src="img/icon_3d.png"></div>
		<div id="mode_2d" class="menu_button"><img src="img/icon_2d.png"></div>
		<div id="mode_columbus" class="menu_button"><img src="img/icon_columbus.png"></div>
	</div>
-->
	<div id="slide_menu"></div>
	<div id="logo"><a href="http://yokohama.localgood.jp" target="_blank"><img src="img/yokohama_logo.png"></a></div>
<!--
<div class="sharebutton">
			<ul class="share-buttons">
				<li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fkanen.mapping.jp%2F&t=" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;"><img class="share" src="data/flat_web_icon_set/color/Facebook.png"></a></li>
				<li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fkanen.mapping.jp%2F&text=:%20http%3A%2F%2Fkanen.mapping.jp%2F&via=hwtnv" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + ':%20'  + encodeURIComponent(document.URL)); return false;"><img class="share" src="data/flat_web_icon_set/color/Twitter.png"></a></li>
				<li><a href="https://plus.google.com/share?url=http%3A%2F%2Fkanen.mapping.jp%2F" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;"><img class="share" src="data/flat_web_icon_set/color/Google+.png"></a></li>
		</ul>
	</div>
-->
	<script>

	var blackOutDiv = document.getElementById("blackOut");
	function viewPoints(_label, _lat, _lng, _heading, _pitch, _range) {
		this.label = _label;
		this.lat = _lat;
		this.lng = _lng;
		this.heading = _heading;
		this.pitch = _pitch;
		this.range = _range;
	}
	
	var viewPointsArray=[];
		viewPointsArray[0]=new viewPoints("横浜市全体",4.633426,95.578812,0,-25,20000);
		viewPointsArray[1]=new viewPoints("青葉区",35.570356,139.519426,0,-10,10000);
		viewPointsArray[2]=new viewPoints("旭区",35.486228,139.533291,0,-10,10000);
		viewPointsArray[3]=new viewPoints("泉区",35.436056,139.498488,0,-10,10000);
		viewPointsArray[4]=new viewPoints("磯子区",35.407283,139.608477,0,-10,10000);
		viewPointsArray[5]=new viewPoints("神奈川区",35.505812,139.615267,0,-10,10000);
		viewPointsArray[6]=new viewPoints("金沢区",35.361470,139.614927,0,-10,10000);
		viewPointsArray[7]=new viewPoints("港南区",35.409580,139.578164,0,-10,10000);
		viewPointsArray[8]=new viewPoints("港北区",35.537409,139.614031,0,-10,10000);
		viewPointsArray[9]=new viewPoints("栄区",35.380718,139.560179,0,-10,10000);
		viewPointsArray[10]=new viewPoints("瀬谷区",35.480602,139.491414,0,-10,10000);
		viewPointsArray[11]=new viewPoints("都筑区",35.555828,139.572365,0,-10,10000);
		viewPointsArray[12]=new viewPoints("鶴見区",35.519496,139.671446,0,-10,10000);
		viewPointsArray[13]=new viewPoints("戸塚区",35.421083,139.531004,0,-10,10000);
		viewPointsArray[14]=new viewPoints("中区",35.446709,139.659198,0,-10,10000);
		viewPointsArray[15]=new viewPoints("西区",35.482484,139.613902,0,-10,10000);
		viewPointsArray[16]=new viewPoints("保土ヶ谷区",35.476567,139.576433,0,-10,10000);
		viewPointsArray[17]=new viewPoints("緑区",35.525050,139.536412,0,-10,10000);
		viewPointsArray[18]=new viewPoints("南区",35.452010,139.599619,0,-10,10000);
		viewPointsArray[19]=new viewPoints("横から見る",35.436119,139.567403,0,-3,14000);
		viewPointsArray[20]=new viewPoints("真上から見る",4.633426,95.578812,0,-85,50000);

		function kmlData(_label, _url) {
			this.label = _label;
			this.url = _url;
		}
		
		var kmlDataArray=[];
			kmlDataArray[0]=new kmlData("背景",'kml/yokohama_pass.kml');
			kmlDataArray[1]=new kmlData("区の情報",'kml/yokohama_file.kml');
			kmlDataArray[2]=new kmlData("LOCAL GOOD PLAYER",'kml/yokohama_player.kml');
			kmlDataArray[3]=new kmlData("課題",'kml/yokohama_task.kml');
//			kmlDataArray[4]=new kmlData("施設情報",'kml/yokohama_sisetsu.kml');
//			kmlDataArray[5]=new kmlData("ジオツイート",'kml/geotweet.kml');

		var osm;
		var mobile = 0;
		var viewPointChangeMenu = document.getElementById('slide_menu');
		var dropDownList = "";
		
		for (var i=0; i<viewPointsArray.length; i++) {
			dropDownList = dropDownList + '<li><a href="#" onclick = "changeViewPoint(' + i + ',' + '5.0);return false;">' + viewPointsArray[i].label + '</a></li>';
		}
		
		var viewPointChangeMenuHtml = '<ul class="viewpoint">' + dropDownList + '</ul>';
		console.log (viewPointChangeMenuHtml);
		viewPointChangeMenu.innerHTML = viewPointChangeMenuHtml;

		var getDevice = (function(){
			var ua = navigator.userAgent;
			if(ua.indexOf('iPhone') > 0 || ua.indexOf('iPod') > 0 || ua.indexOf('Android') > 0 && ua.indexOf('Mobile') > 0){
				mobile = 1;
			}else if(ua.indexOf('iPad') > 0 || ua.indexOf('Android') > 0){
				mobile = 2;
			}else{
				mobile = 0;
			}
		})();

		var viewer = [];


		if (mobile == 0) {
			viewer = new Cesium.Viewer('cesiumContainer',{
			navigationHelpButton : false,
			geocoder:false,
			timeline: true,
			animation: false,
			sceneModePicker: true,
			scene3DOnly : false,
			baseLayerPicker : false,
			fullscreenButton:false
			});
			viewer.camera.frustum.fov = 70 * (3.14 / 180);
			viewer.camera.setView({
				position : Cesium.Cartesian3.fromDegrees(132.45470999999998,34.394915,10000000),
				roll : 0.0
			});
		} else {
			viewer = new Cesium.Viewer('cesiumContainer',{
				sceneMode: Cesium.SceneMode.COLUMBUS_VIEW,
				navigationHelpButton : false,
				geocoder:false,
				timeline: true,
				animation: false,
				sceneModePicker: true,
				scene3DOnly : false,
				baseLayerPicker : false,
				fullscreenButton:false
			});
			viewer.camera.frustum.fov = 70 * (3.14 / 180);
			viewer.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;
			viewer.camera.setView({
				duration : 0.0,
				destination : Cesium.Cartesian3.fromDegrees(132.45470999999998,34.394915,100000),
			});
		}


		if (mobile != 0) {		
			viewer.scene.screenSpaceCameraController.enableTilt = false;			
		}
		blackOut(0);
		setTimeout('groundZero()',0);

		function groundZero(){
			changeViewPoint(20,3);
			setTimeout('landing()',4000);
		}
		
		function landing(){
			changeViewPoint(0,3);
			setTimeout('blackOut(1)',4000);
			setTimeout('loadKml()',10000);
		}

		function loadKml(){
			var i = 0;
			var load = setInterval(function(){
				var promise = Cesium.KmlDataSource.load(kmlDataArray[i].url);
				promise.then(function(dataSource) {
						viewer.dataSources.add(dataSource);
					}).otherwise(function(error){
						alert('KMLデータが読み込めません');
				});
				i++;
				if (i == kmlDataArray.length){
					clearInterval(load);
		            var newLayer =  new Cesium.OpenStreetMapImageryProvider(
		            	{
//		            		 url: '//otile1-s.mqcdn.com/tiles/1.0.0/osm/'
		            	}
		            );
					var layers = viewer.imageryLayers;
					osm = layers.addImageryProvider(newLayer);
					osm.alpha = 1.0;
					osm.brightness = 0.8;
					setTimeout('blackOut(0)',3000);
				}
			}, 200);
		}
		
		function transParent(){
			osm.alpha = document.getElementById("range01").value * 0.05;
		}

		function changeViewPoint(num, delay) {
			var newLat = viewPointsArray[num].lat;
			var newLng = viewPointsArray[num].lng;
			var newHeading = Cesium.Math.toRadians(viewPointsArray[num].heading);
			var newPitch = Cesium.Math.toRadians(viewPointsArray[num].pitch);
			var newRange = viewPointsArray[num].range;

			var center = Cesium.Cartesian3.fromDegrees(newLng, newLat);
			var boundingSphere = new Cesium.BoundingSphere(center, newRange);
			var headingPitchRange = new Cesium.HeadingPitchRange(newHeading, newPitch, newRange);

		    viewer.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;
			viewer.camera.flyToBoundingSphere(boundingSphere,{
				duration : delay,
				offset : headingPitchRange
			});
		}

		function blackOut(param) {
			if (param == 0){
				$(function() {
					$(blackOutDiv).fadeOut("slow");
				});
			} else {
				$(function() {
					$(blackOutDiv).fadeIn("slow");
				});
			} 
		}
/*
		$("#zentai").click(function(){
			changeViewPoint(0,3);
		})

		$("#scene_2d").click(function(){
			changeViewPoint(20,3);
		})
*/	



		$("#check_bar :checkbox").click(function() {
			viewer.dataSources.removeAll();
			viewer.dataSources.add(Cesium.KmlDataSource.load('kml/yokohama_pass.kml'));

			if(document.check_box.local1.checked){
				viewer.dataSources.add(Cesium.KmlDataSource.load('kml/yokohama_player.kml'));
  			}
  			if(document.check_box.local2.checked){
				viewer.dataSources.add(Cesium.KmlDataSource.load('kml/yokohama_file.kml'));
  			}
  			if(document.check_box.local3.checked){
				viewer.dataSources.add(Cesium.KmlDataSource.load('kml/yokohama_task.kml'));
  			}
  	//ジオツイートのczmlの記述
  	/*		else if(document.check_box.local4.checked){
				viewer.dataSources.add(Cesium.CzmlDataSource.load('czml/geotweet.czml'));
  			}
  	*/
  			if(document.check_box.local5.checked){
				viewer.dataSources.add(Cesium.KmlDataSource.load('kml/yokohama_sisetsu.kml'));
  			}
		})


/*
		(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.3";
		  fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));
*/

	</script>
</body>
</html>